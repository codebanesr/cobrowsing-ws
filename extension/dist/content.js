(()=>{class e{constructor(){this.isController=!1,this.isActive=!1,this.lastScrollTime=0,this.scrollThrottle=100,this.setupMessageListener(),this.injectScript()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,s)=>(this.handleMessage(e,t,s),!0))}injectScript(){const e=document.createElement("script");e.src=chrome.runtime.getURL("injected.js"),e.onload=()=>e.remove(),(document.head||document.documentElement).appendChild(e),window.addEventListener("cobrowsing-event",e=>{this.isController&&this.isActive&&this.sendEventToBackground(e.detail.type,e.detail.data)})}handleMessage(e,t,s){switch(e.type){case"apply-sync-event":this.isController||this.applySyncEvent(e.eventType,e.data),s({success:!0});break;case"set-controller":this.isController=e.isController,this.isActive=e.isActive,s({success:!0})}}applySyncEvent(e,t){switch(e){case"scroll":this.applyScroll(t);break;case"click":this.applyClick(t);break;case"input":this.applyInput(t);break;case"navigation":this.applyNavigation(t);break;case"form-submit":this.applyFormSubmit(t)}}applyScroll(e){this.isActive=!1,window.scrollTo({left:e.x,top:e.y,behavior:"smooth"}),setTimeout(()=>{this.isActive=!0},200)}applyClick(e){const t=this.findElementBySelector(e.selector);if(t){const s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,clientX:e.x,clientY:e.y});t.dispatchEvent(s)}}applyInput(e){const t=this.findElementBySelector(e.selector);if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName)){t.value=e.value;const s=new Event("input",{bubbles:!0});t.dispatchEvent(s)}}applyNavigation(e){e.url&&e.url!==window.location.href&&(window.location.href=e.url)}applyFormSubmit(e){const t=this.findElementBySelector(e.formSelector);t&&"FORM"===t.tagName&&t.submit()}findElementBySelector(e){try{return document.querySelector(e)}catch(t){return console.warn("Invalid selector:",e),null}}generateSelector(e){if(!e)return"";if(e.id)return`#${e.id}`;if(e.className&&"string"==typeof e.className){const t=e.className.trim().split(/\s+/).slice(0,3);if(t.length>0)return`${e.tagName.toLowerCase()}.${t.join(".")}`}const t=e.parentElement;if(t){const s=Array.from(t.children).filter(t=>t.tagName===e.tagName).indexOf(e)+1;return`${this.generateSelector(t)} > ${e.tagName.toLowerCase()}:nth-child(${s})`}return e.tagName.toLowerCase()}sendEventToBackground(e,t){chrome.runtime.sendMessage({type:"sync-event",eventType:e,data:t})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new e}):new e})();